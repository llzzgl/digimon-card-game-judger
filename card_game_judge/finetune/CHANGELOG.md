# 更新日志

## [2026-01-26] 卡牌数据集成

### 新增功能

#### 1. 卡牌数据加载与处理
- ✅ 新增 `load_card_data()` 方法，支持从 JSON 文件加载卡牌数据
- ✅ 自动从 3,992 张卡牌生成 17,656 条训练问答
- ✅ 支持中文名、日文名、卡号多种查询方式

#### 2. 多种问答类型生成
- ✅ **卡牌信息查询**（11,925 条）
  - 通过卡号查询完整信息
  - 通过中文名查询
  - 通过日文名查询（含中文名映射）
  
- ✅ **卡牌效果查询**（5,540 条）
  - 主效果查询
  - 进化源效果查询
  - 安防效果查询
  
- ✅ **卡牌搜索**（181 条）
  - 按颜色搜索（采样）
  - 按特征搜索（采样）
  
- ✅ **卡牌对比**（10 条）
  - 同名不同版本对比

#### 3. 新增脚本
- ✅ `test_card_data.py` - 测试卡牌数据加载功能
- ✅ `collect_all_data.py` - 完整的数据收集脚本
- ✅ `README_CARD_DATA.md` - 卡牌数据集成文档
- ✅ `QUICK_START.md` - 快速开始指南

### 代码修改

#### `data_collector.py`
```python
# 新增属性
self.card_qa_pairs: List[QAPair] = []

# 新增系统指令
"card": "你是数码宝贝卡牌游戏(DTCG)的卡牌数据专家..."

# 新增方法
- load_card_data()
- _generate_card_info_qa()
- _generate_card_effect_qa()
- _generate_card_search_qa()
- _generate_card_comparison_qa()
- _format_card_info()

# 更新方法
- get_all_qa_pairs() - 包含卡牌问答
- get_statistics() - 添加卡牌数据统计
- print_statistics() - 显示卡牌数据统计
```

#### `main()` 函数
```python
# 新增参数
--card-data    # 指定卡牌数据路径
--no-cards     # 跳过卡牌数据加载
```

### 数据统计

```
总计: 17,658 条训练数据
├── 规则书问答: 0 条（待添加规则书文件）
├── 官方 Q&A: 2 条（示例数据）
├── 卡牌数据问答: 17,656 条 ⭐
│   ├── 卡牌信息: 11,925 条
│   ├── 卡牌效果: 5,540 条
│   ├── 卡牌搜索: 181 条
│   └── 卡牌对比: 10 条
└── 自定义问答: 0 条
```

### 使用方法

```bash
# 1. 收集所有数据（包括卡牌）
python collect_all_data.py

# 2. 开始微调
python finetune_qwen.py --data training_data/dtcg_finetune_data.jsonl

# 3. 测试卡牌数据加载
python test_card_data.py
```

### 输出文件

```
training_data/
├── dtcg_finetune_data.jsonl      # 微调格式（17,658 条）
├── dtcg_finetune_data.json       # JSON 格式（便于查看）
└── dtcg_conversation.jsonl       # 对话格式
```

### 示例问答

**问：** EX11-026 是什么卡？请提供详细信息。

**答：**
```
【EX11-026】飞翼兽（プテロモン）

• 类型：数码兽卡
• 稀有度：C
• 颜色：绿
• 等级：Lv.3
• 形态：成长期
• 属性：数据
• 特征：鸟龙型/界放者
• 登场费用：3
• DP：1000
• 进化条件：绿 / Lv.2 / 费用 0

【效果】
【移动时】【登场时】你可以将1只数码兽休眠。如果通过这个效果将自己的数码兽休眠，直到对手的回合结束为止，自己的1只特征中包含「鸟（鳥）」或特征中持有「旋风战士（ヴォルテクスウォリアー）」的数码兽DP+3000。

【进化源效果】
【自己的回合】［1回合1次］这只数码兽在战斗中胜利时，内存值+1。
```

### 技术细节

#### 数据格式
```json
{
  "instruction": "你是数码宝贝卡牌游戏(DTCG)的卡牌数据专家。请准确回答关于卡牌信息和效果的问题。",
  "input": "EX11-026 是什么卡？请提供详细信息。",
  "output": "【EX11-026】飞翼兽（プテロモン）\n\n• 类型：数码兽卡\n..."
}
```

#### 卡牌数据结构
```json
{
  "card_no": "EX11-026",
  "name_cn": "飞翼兽",
  "name_jp": "プテロモン",
  "type": "数码兽卡",
  "rarity": "C",
  "color": "绿",
  "level": "3",
  "form": "成长期",
  "attribute": "数据",
  "species": "鸟龙型/界放者",
  "play_cost": "3",
  "dp": "1000",
  "evolution_condition": "绿 / Lv.2 / 费用 0",
  "effect": "...",
  "inherited_effect": "...",
  "security_effect": ""
}
```

### 性能优化

- ✅ 使用采样策略减少搜索类问答数量（避免数据冗余）
- ✅ 对同名卡牌对比限制数量（最多 10 个）
- ✅ 支持跳过卡牌数据加载（`--no-cards`）

### 已知问题

1. **规则书数据缺失** - 需要添加规则书文件路径
2. **官方 Q&A 数据少** - 仅有 2 条示例数据
3. **数据不平衡** - 卡牌数据占比过大（99.9%）

### 下一步计划

- [ ] 添加规则书数据提取
- [ ] 收集更多官方 Q&A
- [ ] 实现数据采样和平衡策略
- [ ] 添加数据增强功能
- [ ] 生成卡牌组合和策略问答

### 贡献者

- 开发者：[Your Name]
- 日期：2026-01-26
- 版本：v1.1.0

---

## [之前版本]

### [2026-01-XX] 初始版本
- ✅ 基础微调框架
- ✅ 规则书数据提取
- ✅ 官方 Q&A 接口
- ✅ 自定义问答支持
